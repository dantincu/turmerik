<div
  [ngClass]="['trmrk-app-panel', panelListService.showPendingReorderStrip || panelListService.selectedRowsCount > 0 ? 'trmrk-has-bottom-horiz-strip' : '', trmrkCssClass ?? '',
  panelListService.showAcceleratingScrollPopovers ? 'trmrk-has-accelerating-popovers' : '',
  (trmrkIsLoading || trmrkHasError) ? 'trmrk-has-top-message-horiz-strip' : '',]"
>
  @if (!panelListService.showAcceleratingScrollPopovers) {
  <div class="trmrk-panel-header" #panelHeader>
    <trmrk-horiz-strip
      [trmrkCssClass]="['trmrk-has-border-x2 trmrk-top-horiz-strip']"
      [trmrkLeadingTemplate]="topHorizStripLeadingTemplate"
    >
    </trmrk-horiz-strip>
    <ng-template #topHorizStripLeadingTemplate>
      @if (panelListService.rowsAreSelectable) {
      <button mat-icon-button class="trmrk-icon-btn">
        <mat-checkbox
          class="trmrk-checkbox"
          (change)="rowsMasterCheckBoxToggled($event)"
          [checked]="panelListService.rowsMasterCheckBoxIsChecked"
        ></mat-checkbox>
      </button>
      }
      <trmrk-accelerating-scroll-control
        [trmrkScrollable]="getPanelList"
      ></trmrk-accelerating-scroll-control>
    </ng-template>
    @if (trmrkIsLoading) { @if (trmrkLoadingTemplate) {
    <ng-container *ngTemplateOutlet="trmrkLoadingTemplate"></ng-container> } @if
    (!trmrkLoadingTemplate) {
    <trmrk-horiz-strip
      [trmrkCssClass]="['trmrk-has-border-x2 trmrk-top-message-horiz-strip']"
      [trmrkLeadingTemplate]="trmrkLoadingTemplate"
    >
    </trmrk-horiz-strip>
    <ng-template #trmrkLoadingTemplate>
      <trmrk-loading></trmrk-loading>
    </ng-template>
    } } @if (hasError) {
    <trmrk-horiz-strip
      [trmrkCssClass]="['trmrk-has-border-x2 trmrk-top-message-horiz-strip trmrk-error-message-horiz-strip']"
      [trmrkMainText]="trmrkErrorTitle"
      [trmrkDetailsTextParts]="((trmrkErrorMsg ?? null) !== null) ? [{text: trmrkErrorMsg!, italic: false}] : null"
      [trmrkTrailingTemplate]="trmrkErrorHorizStripTrailingTemplate"
    >
    </trmrk-horiz-strip>
    <ng-template #trmrkErrorHorizStripTrailingTemplate>
      @if (trmrkCanCloseError) {
      <button mat-icon-button class="trmrk-icon-btn" (click)="closeError()">
        <mat-icon class="trmrk-icon">close</mat-icon>
      </button>
      }
    </ng-template>
    }
  </div>
  } @if (panelListService.showAcceleratingScrollPopovers) {
  <trmrk-accelerating-scroll-popover
    #upAcceleratingScrollPopover
    [trmrkFocusedPadIdx]="panelListService.acceleratingScrollPadIdx"
  ></trmrk-accelerating-scroll-popover>
  } @if (trmrkEntities.length) {
  <trmrk-panel-list
    #panelList
    [trmrkPanelHeader]="getPanelHeader"
    [trmrkEntities]="trmrkEntities"
    [trmrkEntityKeyPropName]="trmrkEntityKeyPropName"
    [trmrkRowsSelectionIsAllowed]="trmrkRowsSelectionIsAllowed"
    [trmrkSelectedRowsReorderIsAllowed]="trmrkSelectedRowsReorderIsAllowed"
    [trmrkSelectedRowsReorderAggRowVertIsOriented]="trmrkSelectedRowsReorderAggRowVertIsOriented"
    [trmrkUpAcceleratingScrollPopover]="getUpAcceleratingScrollPopover"
    [trmrkDownAcceleratingScrollPopover]="getDownAcceleratingScrollPopover"
    [trmrkListItems]="trmrkListItems"
    [trmrkVisuallyMovingListItems]="trmrkVisuallyMovingListItems"
    (trmrkRowsUpdated)="trmrkRowsUpdated.emit($event)"
    [trmrkRowMenuTemplate]="trmrkRowMenuTemplate"
    [trmrkRowTemplate]="trmrkRowTemplate"
    [trmrkVisuallyMovingRowTemplate]="trmrkVisuallyMovingRowTemplate"
  ></trmrk-panel-list
  >} @if (!trmrkEntities.length) {
  <ng-container *ngTemplateOutlet="trmrkNoItemsTemplate"></ng-container> } @if
  (!panelListService.showAcceleratingScrollPopovers) { @if
  (panelListService.showPendingReorderStrip) {
  <trmrk-horiz-strip
    [trmrkCssClass]="['trmrk-bottom-horiz-strip trmrk-has-border-x2']"
    [trmrkMainText]="'Apply new order'"
    [trmrkLeadingTemplate]="applyNewOrderHorizStripLeadingTemplate"
    [trmrkTrailingTemplate]="applyNewOrderHorizStripTrailingTemplate"
  ></trmrk-horiz-strip>
  <ng-template #applyNewOrderHorizStripLeadingTemplate>
    <button
      mat-icon-button
      class="trmrk-icon-btn"
      (click)="applyNewOrderClose()"
    >
      <mat-icon class="trmrk-icon">close</mat-icon>
    </button>
  </ng-template>
  <ng-template #applyNewOrderHorizStripTrailingTemplate>
    <button mat-icon-button class="trmrk-icon-btn trmrk-icon-btn-filled-accept">
      <mat-icon class="trmrk-icon">check</mat-icon>
    </button>
    <button mat-icon-button class="trmrk-icon-btn trmrk-icon-btn-filled-reject">
      <mat-icon class="trmrk-icon">cancel</mat-icon>
    </button>
  </ng-template>
  } @if (!panelListService.showPendingReorderStrip &&
  panelListService.selectedRowsCount > 0) {
  <trmrk-horiz-strip
    [trmrkCssClass]="['trmrk-bottom-horiz-strip trmrk-has-border-x2']"
    [trmrkMainText]="panelListService.selectedRowsCount + ' item' + (panelListService.selectedRowsCount > 1 ? 's' : '') + ' selected'"
    [trmrkLeadingTemplate]="selectedItemsHorizStripLeadingTemplate"
  ></trmrk-horiz-strip>
  <ng-template #selectedItemsHorizStripLeadingTemplate>
    <button
      mat-icon-button
      class="trmrk-icon-btn"
      (click)="clearSelectedRows()"
    >
      <mat-icon class="trmrk-icon">close</mat-icon>
    </button>
  </ng-template>
  } } @if (panelListService.showAcceleratingScrollPopovers) {
  <trmrk-accelerating-scroll-popover
    #downAcceleratingScrollPopover
    [trmrkHasCancelBtn]="true"
    [trmrkFocusedPadIdx]="panelListService.acceleratingScrollPadIdx - 3"
    [trmrkCancelBtnIsFocused]="panelListService.downAcceleratingPopoverCancelBtnIsFocused"
  ></trmrk-accelerating-scroll-popover>
  }
</div>
