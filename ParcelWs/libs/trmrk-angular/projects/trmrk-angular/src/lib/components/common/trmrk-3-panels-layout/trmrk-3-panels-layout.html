<div [ngClass]="cssClass" #containerEl>
  @if (trmrkAlwaysRenderLeftPanel || showLeftPanel) {
  <div
    #leftPanelEl
    [ngClass]="[
      'trmrk-app-panel',
      'trmrk-left-panel',
      showLeftPanel ? '' : 'trmrk-hidden',
      activePanel === PanelPosition.Left ? 'trmrk-is-active' : ''
    ]"
    [ngStyle]="panelStyles[0]"
    (trmrkTouchStartOrMouseDown)="leftPanelTouchStartOrMouseDown($event)"
  >
    <trmrk-horiz-strip
      [trmrkCssClass]="[
        'trmrk-top-horiz-strip',
        'trmrk-app-panel-header',
        activePanel === PanelPosition.Left ? 'trmrk-has-border-x2' : ''
      ]"
      [trmrkLeadingTemplate]="leftPanelHeaderLeadingTemplate"
      [trmrkTrailingTemplate]="leftPanelHeaderTrailingTemplate"
    >
    </trmrk-horiz-strip>
    <ng-template #leftPanelHeaderLeadingTemplate></ng-template>
    <ng-template #leftPanelHeaderTrailingTemplate>
      @if (trmrkShowLeftPanelOptionsBtn) {
      <button
        mat-icon-button
        class="trmrk-icon-btn"
        [matMenuTriggerFor]="null"
        #leftPanelOptionsMenuTrigger="matMenuTrigger"
        (click)="leftPanelOptionsMenuBtnClick()"
      >
        <mat-icon class="trmrk-icon">more_vert</mat-icon>
      </button>
      <mat-menu #leftPanelOptionsMenu class="trmrk-menu" dense>
        <ng-container *ngTemplateOutlet="trmrkLeftPanelOptionsMenuTemplate"></ng-container>
      </mat-menu>
      } @if (trmrkAllowToggleLeftPanel) {
      <button mat-icon-button class="trmrk-icon-btn">
        <mat-icon class="trmrk-icon">close</mat-icon>
      </button>
      } @if (visiblePanelsCount > 1) {
      <div
        class="trmrk-resize-btn-wrapper"
        [ngClass]="[
          'trmrk-resize-btn-wrapper',
          resizeLeftPanelStripCloseActionIsActivated
            ? 'trmrk-close-action-activated'
            : resizeLeftPanelStripResetActionIsActivated
            ? 'trmrk-reset-action-activated'
            : ''
        ]"
      >
        <button
          mat-icon-button
          [ngClass]="['trmrk-icon-btn trmrk-resize-btn']"
          (trmrkDrag)="leftPanelResizeBtnDrag($event)"
          (trmrkDragStart)="leftPanelResizeBtnDragStart($event)"
          (trmrkDragEnd)="leftPanelResizeBtnDragEnd($event)"
          [trmrkPreventDefaults]="true"
        >
          <div class="trmrk-custom-svg-icon" [innerHtml]="drag_pan"></div>
        </button>
      </div>
      }</ng-template
    >
    <div class="trmrk-app-panel-content trmrk-scrollable trmrk-scrollable-y trmrk-scrollable-x">
      <ng-container *ngTemplateOutlet="trmrkLeftPanelTemplate"></ng-container>
    </div>

    @if (isResizingLeftPanel) {
    <div
      [ngClass]="[
        'trmrk-panel-resize-strip trmrk-stick-right',
        resizeLeftPanelStripCloseActionIsActivated
          ? 'trmrk-close-action-activated'
          : resizeLeftPanelStripResetActionIsActivated
          ? 'trmrk-reset-action-activated'
          : ''
      ]"
      #resizeLeftPanelStrip
    >
      <button mat-icon-button class="trmrk-icon-btn">
        <mat-icon class="trmrk-icon">close</mat-icon>
      </button>
      <button mat-icon-button class="trmrk-icon-btn">
        <div class="trmrk-custom-svg-icon" [innerHtml]="recenter"></div>
      </button>
      <div class="trmrk-stretch"></div>
      <button mat-icon-button class="trmrk-icon-btn">
        <mat-icon class="trmrk-icon">close</mat-icon>
      </button>
      <button mat-icon-button class="trmrk-icon-btn">
        <div class="trmrk-custom-svg-icon" [innerHtml]="recenter"></div>
      </button>
    </div>
    }
  </div>
  } @if (trmrkAlwaysRenderMiddlePanel || showMiddlePanel) {
  <div
    [ngClass]="[
      'trmrk-app-panel',
      'trmrk-middle-panel',
      showMiddlePanel ? '' : 'trmrk-hidden',
      activePanel === PanelPosition.Middle ? 'trmrk-is-active' : ''
    ]"
    [ngStyle]="panelStyles[1]"
    (trmrkTouchStartOrMouseDown)="middlePanelTouchStartOrMouseDown($event)"
  >
    <trmrk-horiz-strip
      [trmrkCssClass]="[
        'trmrk-top-horiz-strip',
        'trmrk-app-panel-header',
        activePanel === PanelPosition.Middle ? 'trmrk-has-border-x2' : ''
      ]"
      [trmrkLeadingTemplate]="middlePanelHeaderLeadingTemplate"
      [trmrkTrailingTemplate]="middlePanelHeaderTrailingTemplate"
    ></trmrk-horiz-strip>
    <ng-template #middlePanelHeaderLeadingTemplate></ng-template>
    <ng-template #middlePanelHeaderTrailingTemplate>
      @if (trmrkAllowToggleLeftPanel && !showLeftPanel) {
      <button mat-icon-button class="trmrk-icon-btn">
        <div class="trmrk-custom-svg-icon" [innerHtml]="left_panel_open"></div>
      </button>
      } @if (trmrkShowMiddlePanelOptionsBtn) {
      <button
        mat-icon-button
        class="trmrk-icon-btn"
        [matMenuTriggerFor]="null"
        #middlePanelOptionsMenuTrigger="matMenuTrigger"
        (click)="middlePanelOptionsMenuBtnClick()"
      >
        <mat-icon class="trmrk-icon">more_vert</mat-icon>
      </button>
      <mat-menu #middlePanelOptionsMenu class="trmrk-menu" dense>
        <ng-container *ngTemplateOutlet="trmrkMiddlePanelOptionsMenuTemplate"></ng-container>
      </mat-menu>
      } @if (trmrkAllowToggleMiddlePanel && showRightPanel) {
      <button mat-icon-button class="trmrk-icon-btn">
        <mat-icon class="trmrk-icon">close</mat-icon>
      </button>
      }
    </ng-template>
    <div class="trmrk-app-panel-content trmrk-scrollable trmrk-scrollable-y trmrk-scrollable-x">
      <ng-container *ngTemplateOutlet="trmrkMiddlePanelTemplate"></ng-container>
    </div>
  </div>
  } @if (trmrkAlwaysRenderRightPanel || showRightPanel) {
  <div
    #rightPanelEl
    [ngClass]="[
      'trmrk-app-panel',
      'trmrk-right-panel',
      showRightPanel ? '' : 'trmrk-hidden',
      activePanel === PanelPosition.Right ? 'trmrk-is-active' : ''
    ]"
    [ngStyle]="panelStyles[2]"
    (trmrkTouchStartOrMouseDown)="rightPanelTouchStartOrMouseDown($event)"
  >
    <trmrk-horiz-strip
      [trmrkCssClass]="[
        'trmrk-top-horiz-strip',
        'trmrk-app-panel-header',
        activePanel === PanelPosition.Right ? 'trmrk-has-border-x2' : ''
      ]"
      [trmrkLeadingTemplate]="rightPanelHeaderLeadingTemplate"
      [trmrkTrailingTemplate]="rightPanelHeaderTrailingTemplate"
    ></trmrk-horiz-strip>
    <ng-template #rightPanelHeaderLeadingTemplate
      >@if (trmrkAlwaysRenderMiddlePanel || showMiddlePanel) {
      <div
        [ngClass]="[
          'trmrk-resize-btn-wrapper',
          resizeRightPanelStripCloseActionIsActivated
            ? 'trmrk-close-action-activated'
            : resizeRightPanelStripResetActionIsActivated
            ? 'trmrk-reset-action-activated'
            : ''
        ]"
      >
        <button
          mat-icon-button
          class="trmrk-icon-btn trmrk-resize-btn"
          (trmrkDrag)="rightPanelResizeBtnDrag($event)"
          (trmrkDragStart)="rightPanelResizeBtnDragStart($event)"
          (trmrkDragEnd)="rightPanelResizeBtnDragEnd($event)"
          [trmrkPreventDefaults]="true"
        >
          <div class="trmrk-custom-svg-icon" [innerHtml]="drag_pan"></div>
        </button>
      </div>
      }</ng-template
    >
    <ng-template #rightPanelHeaderTrailingTemplate>
      @if (trmrkShowRightPanelOptionsBtn) {
      <button
        mat-icon-button
        class="trmrk-icon-btn"
        [matMenuTriggerFor]="null"
        #rightPanelOptionsMenuTrigger="matMenuTrigger"
        (click)="rightPanelOptionsMenuBtnClick()"
      >
        <mat-icon class="trmrk-icon">more_vert</mat-icon>
      </button>
      <mat-menu #rightPanelOptionsMenu class="trmrk-menu" dense>
        <ng-container *ngTemplateOutlet="trmrkRightPanelOptionsMenuTemplate"></ng-container>
      </mat-menu>
      } @if (trmrkAllowToggleRightPanel && showMiddlePanel) {
      <button mat-icon-button class="trmrk-icon-btn">
        <mat-icon class="trmrk-icon">close</mat-icon>
      </button>
      }
    </ng-template>
    <div class="trmrk-app-panel-content trmrk-scrollable trmrk-scrollable-y trmrk-scrollable-x">
      <ng-container *ngTemplateOutlet="trmrkRightPanelTemplate"></ng-container>
    </div>
    @if (isResizingRightPanel) {
    <div
      [ngClass]="[
        'trmrk-panel-resize-strip trmrk-stick-left',
        resizeRightPanelStripCloseActionIsActivated
          ? 'trmrk-close-action-activated'
          : resizeRightPanelStripResetActionIsActivated
          ? 'trmrk-reset-action-activated'
          : ''
      ]"
      #resizeRightPanelStrip
    >
      <button mat-icon-button class="trmrk-icon-btn">
        <mat-icon class="trmrk-icon">close</mat-icon>
      </button>
      <button mat-icon-button class="trmrk-icon-btn">
        <div class="trmrk-custom-svg-icon" [innerHtml]="recenter"></div>
      </button>
      <div class="trmrk-stretch"></div>
      <button mat-icon-button class="trmrk-icon-btn">
        <mat-icon class="trmrk-icon">close</mat-icon>
      </button>
      <button mat-icon-button class="trmrk-icon-btn">
        <div class="trmrk-custom-svg-icon" [innerHtml]="recenter"></div>
      </button>
    </div>
    }
  </div>
  }
</div>
